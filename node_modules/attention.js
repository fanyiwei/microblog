var mongodb = require('./db');

function Attention(attCollection) {
	this.from = attCollection.from;
	this.to = attCollection.to;
}

module.exports = Attention;

Attention.prototype.save = function save(callback) {
	var attCollection = {
		from:this.from,
		to:this.to
	};
	mongodb.open(function(err,db) {
		if(err) {
			return callback(err);
		}
		db.collection('attention',function(err,collection) {
			if(err) {
				mongodb.close();
				return callback(err);
			}
			collection.insert(attCollection,function(err,doc) {
				mongodb.close();
				console.log(doc);
				callback(err,doc);
			});
		});
	});
};

Attention.prototype.cancel = function cancel(callback) {
	var attCollection = {
		from:this.from,
		to:this.to
	};
	mongodb.open(function(err,db) {
		if(err) {
			return callback(err);
		}
		db.collection('attention',function(err,collection) {
			if(err) {
				mongodb.close();
				return callback(err);
			}
			collection.remove(attCollection,function(err,doc) {
				mongodb.close();
				callback(err,doc);
			});
		});
	});
};

Attention.getAttention = function getAttention(fromEmail,callback) {
	mongodb.open(function(err,db) {
		if(err) {
			return callback(er);
		}
		db.collection('attention',function(err,collection) {
			if(err) {
				mongodb.close();
				return callback(err);
			}
			collection.find({"from":fromEmail}).toArray(function(err,docs) {
				mongodb.close();
				callback(err,docs);
			});
		});
	});
};